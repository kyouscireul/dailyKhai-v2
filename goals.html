<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khai's Goals</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { -webkit-tap-highlight-color: transparent; }
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; }
        /* Hide number spinner */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- INTERNAL ICON SYSTEM ---
        const Icon = ({ children, size = 24, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );

        const lucideReact = {
            Target: (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></Icon>,
            TrendingUp: (props) => <Icon {...props}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></Icon>,
            Layers: (props) => <Icon {...props}><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></Icon>,
            ListTodo: (props) => <Icon {...props}><rect x="3" y="5" width="6" height="6" rx="1"/><path d="m3 17 2 2 4-4"/><path d="M13 6h8"/><path d="M13 12h8"/><path d="M13 18h8"/></Icon>,
            Award: (props) => <Icon {...props}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></Icon>,
            Minus: (props) => <Icon {...props}><path d="M5 12h14"/></Icon>,
            Plus: (props) => <Icon {...props}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>,
        };

        const { Target, TrendingUp, Layers, ListTodo, Award, Minus, Plus } = lucideReact;

        // --- COMPONENTS MOVED OUTSIDE TO FIX FOCUS ISSUES ---

        const GoalCard = ({ label, value, inputValue, max, unit, onInputChange }) => (
            <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 mb-3">
                <div className="flex justify-between items-center mb-2">
                    <span className="font-bold text-slate-700">{label}</span>
                    <div className="flex items-center gap-1 bg-slate-50 px-2 py-1 rounded-lg border border-slate-200">
                            <span className="text-xs font-bold text-slate-400">{unit}</span>
                            <input 
                            type="number" 
                            value={inputValue} 
                            onChange={(e) => onInputChange(e.target.value)}
                            className="w-20 text-right font-bold text-slate-700 bg-transparent outline-none p-0 m-0"
                            inputMode="numeric"
                            />
                            {max && <span className="text-xs font-medium text-slate-400 ml-1">/ {max}</span>}
                    </div>
                </div>
                {max && (
                    <div className="h-3 bg-slate-100 rounded-full overflow-hidden mb-2 relative">
                        <div className="h-full bg-emerald-500 transition-all" style={{ width: `${Math.min(100, (value/max)*100)}%` }}></div>
                    </div>
                )}
            </div>
        );

        const SkillSlider = ({ label, value, onChange }) => (
            <div className="mb-5">
                <div className="flex justify-between text-xs font-bold text-slate-600 mb-2">
                    <span>{label}</span>
                    <span>{value}%</span>
                </div>
                <div className="flex items-center gap-3">
                    <button onClick={() => onChange(Math.max(0, value - 1))} className="w-8 h-8 flex items-center justify-center bg-slate-100 rounded-lg text-slate-600 font-bold hover:bg-slate-200 active:scale-95 transition-all"><Minus size={14} /></button>
                    <div className="flex-1 h-4 bg-slate-100 rounded-full overflow-hidden relative">
                        <div className="h-full bg-indigo-500 transition-all duration-300 ease-out" style={{ width: `${value}%` }}></div>
                        <input type="range" min="0" max="100" value={value} onChange={(e) => onChange(e.target.value)} className="absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer" />
                    </div>
                    <button onClick={() => onChange(Math.min(100, value + 1))} className="w-8 h-8 flex items-center justify-center bg-slate-100 rounded-lg text-slate-600 font-bold hover:bg-slate-200 active:scale-95 transition-all"><Plus size={14} /></button>
                </div>
            </div>
        );

        const GoalsApp = () => {
            
            // --- DATA: GOALS ---
            const defaultGoals = {
                savings: 0,
                savingsTarget: 5000,
                skills: {
                    frontend: 20,
                    backend: 10,
                    ai: 15
                }
            };

            const [goals, setGoals] = useState(() => {
                const saved = localStorage.getItem('khaiGoals_v1');
                const savedData = saved ? JSON.parse(saved) : {};
                return {
                    savings: savedData.savings !== undefined ? savedData.savings : defaultGoals.savings,
                    savingsTarget: defaultGoals.savingsTarget,
                    skills: savedData.skills || defaultGoals.skills,
                };
            });

            // Separate state for the input field to allow typing "2", "25", "250" without jitter
            const [savingInput, setSavingInput] = useState(String(goals.savings));

            useEffect(() => {
                localStorage.setItem('khaiGoals_v1', JSON.stringify(goals));
            }, [goals]);

            const updateSkill = (key, value) => {
                const cleanValue = Math.min(100, Math.max(0, parseInt(value) || 0));
                setGoals(prev => ({
                    ...prev,
                    skills: { ...prev.skills, [key]: cleanValue }
                }));
            };

            const handleSavingChange = (val) => {
                setSavingInput(val); // Update the text box immediately
                
                if (val === '') return; // Allow empty field while typing

                const num = parseInt(val);
                if (!isNaN(num)) {
                    // Update the actual goal state
                    setGoals(prev => ({ ...prev, savings: num }));
                }
            };

            const pillars = [
                { id: 'focus', label: 'Focus', file: 'focus.html' },
                { id: 'clarity', label: 'Clarity', file: 'clarity.html' },
                { id: 'streak', label: 'Streak', file: 'streak.html' },
                { id: 'physical', label: 'Physical', file: 'physical.html' },
                { id: 'academic', label: 'Academic', file: 'academic.html' },
                { id: 'financial', label: 'Financial', file: 'financial.html' },
                { id: 'spiritual', label: 'Spiritual', file: 'spiritual.html' },
                { id: 'emotional', label: 'Emotional', file: 'emotional.html' },
            ];

            return (
                <div className="min-h-screen font-sans pb-24">
                    <div className="bg-white shadow-sm sticky top-0 z-10">
                        <div className="max-w-md mx-auto px-4 pt-4 pb-2">
                            <div>
                                <h1 className="text-2xl font-black text-slate-800 tracking-tight">Goal Board</h1>
                                <p className="text-slate-500 text-sm font-medium">Vision & Progress</p>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-md mx-auto px-4 py-4 space-y-6">
                        {/* Pillars Grid */}
                        <div className="grid grid-cols-2 gap-2">
                            {pillars.map(pillar => (
                                <a 
                                    key={pillar.id}
                                    href={pillar.file}
                                    className="bg-white border border-slate-200 rounded-lg p-3 text-center text-sm font-bold text-slate-600 shadow-sm hover:border-indigo-300 hover:text-indigo-600 transition-colors block"
                                >
                                    {pillar.label}
                                </a>
                            ))}
                        </div>

                        {/* Financial Section */}
                        <GoalCard 
                            label="Saving Goal" 
                            unit="RM " 
                            value={goals.savings} // For progress bar
                            inputValue={savingInput} // For text input
                            max={goals.savingsTarget} 
                            onInputChange={handleSavingChange} 
                        />
                        
                        {/* Skills */}
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                            <h2 className="text-sm font-black text-slate-800 uppercase tracking-wider mb-4 flex items-center gap-2">
                                <Layers size={16} /> Skill Progression
                            </h2>
                            <SkillSlider label="Front End Skill" value={goals.skills.frontend} onChange={(v) => updateSkill('frontend', v)} />
                            <SkillSlider label="Back End Skill" value={goals.skills.backend} onChange={(v) => updateSkill('backend', v)} />
                            <SkillSlider label="AI & Tools" value={goals.skills.ai} onChange={(v) => updateSkill('ai', v)} />
                        </div>
                    </div>

                    <div className="fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 p-2 z-50">
                        <div className="max-w-md mx-auto flex justify-around">
                            <a href="index.html" className="flex flex-col items-center p-2 rounded-xl transition-all text-slate-400 hover:text-blue-600">
                                <ListTodo size={24} />
                                <span className="text-[10px] font-bold mt-1">ROUTINE</span>
                            </a>
                            <button className="flex flex-col items-center p-2 rounded-xl transition-all text-indigo-600 bg-indigo-50">
                                <Award size={24} />
                                <span className="text-[10px] font-bold mt-1">GOALS</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<GoalsApp />);
    </script>
</body>
</html>